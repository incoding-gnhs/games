# 게임 공통 시스템 사용 가이드

## 📚 개요

모든 게임에서 로그인, 점수 저장, 랭킹 표시 기능을 공통으로 사용할 수 있는 시스템입니다.

## 🚀 기본 사용법

### 1. HTML 구조

```html
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>내 게임</title>
</head>
<body>
    <div id="gameContainer">
        <!-- 게임 화면 HTML -->
        <div id="myGameScreen" class="hidden">
            <!-- 게임 내용 -->
        </div>
    </div>

    <!-- 게임 시스템 로드 -->
    <script src="/game-system.js"></script>
    
    <script>
        // 게임 로직
    </script>
</body>
</html>
```

### 2. 게임 시스템 초기화

```javascript
// 게임 이름으로 시스템 생성 (DB에 저장될 이름)
const gameSystem = new GameSystem('내게임이름');

// 컨테이너에 시스템 초기화
gameSystem.initialize('gameContainer');
```

### 3. 게임 시작/종료 콜백 설정

```javascript
// 게임 시작 시 호출
gameSystem.onGameStart((gameState) => {
    console.log('게임 시작:', gameState);
    // gameState.studentId - 학번
    // gameState.studentName - 이름
    // gameState.isGuest - 게스트 여부
    
    // 게임 화면 표시
    document.getElementById('myGameScreen').classList.remove('hidden');
    
    // 게임 초기화 로직
    startMyGame();
});

// 게임 종료 시 호출
gameSystem.onGameEnd((gameState) => {
    console.log('게임 종료:', gameState);
    // 게임 화면 숨김
    document.getElementById('myGameScreen').classList.add('hidden');
});
```

### 4. 게임 종료 처리

```javascript
function endMyGame() {
    const finalScore = 1000; // 최종 점수
    const playTime = 60; // 플레이 시간 (초)
    
    // 점수 저장 및 랭킹 표시
    gameSystem.endGame(finalScore, playTime);
}
```

### 5. 로그인 화면 표시

```javascript
// 페이지 로드 시 로그인 화면 표시
window.addEventListener('load', () => {
    gameSystem.showLoginScreen();
});
```

## 📖 주요 API

### GameSystem 클래스

#### 생성자
- `new GameSystem(gameName)` - 게임 시스템 객체 생성
  - `gameName`: 데이터베이스에 저장될 게임 이름

#### 메서드

| 메서드 | 설명 |
|--------|------|
| `initialize(containerElement)` | 시스템 초기화 및 HTML/CSS 추가 |
| `showLoginScreen()` | 로그인 화면 표시 |
| `hideLoginScreen()` | 로그인 화면 숨김 |
| `showGameOverScreen()` | 게임 오버 화면 표시 |
| `hideGameOverScreen()` | 게임 오버 화면 숨김 |
| `endGame(score, playTime)` | 게임 종료, 점수 저장, 랭킹 표시 |
| `startGuestMode()` | 게스트 모드로 게임 시작 |
| `onGameStart(callback)` | 게임 시작 콜백 등록 |
| `onGameEnd(callback)` | 게임 종료 콜백 등록 |
| `getUser()` | 현재 사용자 정보 반환 |
| `isPlaying()` | 플레이 중 여부 반환 |
| `restartGame()` | 게임 재시작 |
| `changeUser()` | 사용자 변경 (로그인 화면으로) |
| `goHome()` | 홈으로 이동 |

#### gameState 객체 구조

```javascript
{
    studentId: '',      // 학번
    studentName: '',    // 이름
    score: 0,          // 점수
    isGuest: false,    // 게스트 여부
    isPlaying: false,  // 플레이 중 여부
    playTime: 0        // 플레이 시간
}
```

## 💡 완전한 예제

```html
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>간단한 타이머 게임</title>
    <style>
        .hidden { display: none !important; }
        .game-screen {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
        }
        .timer {
            font-size: 48px;
            color: #667eea;
            margin: 20px;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <div id="gameScreen" class="game-screen hidden">
            <h2>⏱️ 타이머 게임</h2>
            <div id="displayUser"></div>
            <div class="timer" id="timer">10</div>
            <button id="stopButton">정지!</button>
        </div>
    </div>

    <script src="/game-system.js"></script>
    <script>
        const gameSystem = new GameSystem('타이머게임');
        gameSystem.initialize('gameContainer');

        let countdown = 10;
        let interval = null;

        gameSystem.onGameStart((gameState) => {
            document.getElementById('displayUser').textContent = 
                `${gameState.studentName} (${gameState.studentId})`;
            document.getElementById('gameScreen').classList.remove('hidden');
            
            countdown = 10;
            document.getElementById('timer').textContent = countdown;
            
            interval = setInterval(() => {
                countdown--;
                document.getElementById('timer').textContent = countdown;
                if (countdown <= 0) {
                    endGame();
                }
            }, 1000);
        });

        gameSystem.onGameEnd(() => {
            document.getElementById('gameScreen').classList.add('hidden');
        });

        document.getElementById('stopButton').onclick = () => {
            endGame();
        };

        function endGame() {
            clearInterval(interval);
            const score = countdown * 100; // 남은 시간이 점수
            gameSystem.endGame(score, 10 - countdown);
        }

        window.addEventListener('load', () => {
            gameSystem.showLoginScreen();
        });
    </script>
</body>
</html>
```

## 🎨 커스터마이징

모든 CSS 클래스는 `game-system-` 접두사를 사용하므로 기존 스타일과 충돌하지 않습니다.

필요한 경우 자체 스타일을 추가하여 오버라이드할 수 있습니다:

```css
.game-system-btn-primary {
    background: #your-color !important;
}
```

## 📋 제공되는 기능

### ✅ 자동으로 처리되는 것들

1. **로그인 시스템**
   - 학번/이름 입력
   - 사용자 검증
   - 이름 불일치 처리
   - 게스트 모드

2. **점수 저장**
   - API 호출
   - 에러 처리
   - 게스트는 저장 안 함

3. **랭킹 표시**
   - 현재 점수 기준 순위
   - 최고 기록 기준 랭킹 목록
   - 상위 퍼센트 계산
   - 내 위아래 플레이어 표시

4. **게임 오버 화면**
   - 사용자 정보
   - 최종 점수
   - 랭킹 정보
   - 다시 시작/사용자 변경/홈 버튼

### 🔧 직접 구현해야 하는 것들

1. **게임 로직**
   - 게임 규칙
   - 점수 계산
   - 게임 화면 UI

2. **게임 시작/종료 타이밍**
   - 언제 게임을 시작할지
   - 언제 게임을 종료할지
   - 점수를 어떻게 계산할지

## 🔍 주의사항

1. **게임 이름**: `new GameSystem('게임이름')`의 게임 이름은 데이터베이스에 저장되므로 일관되게 사용해야 합니다.

2. **점수 저장**: `endGame(score, playTime)` 호출 시 자동으로 점수가 저장됩니다.

3. **게스트 모드**: 게스트는 점수가 저장되지 않지만 랭킹은 볼 수 있습니다.

4. **초기화**: 반드시 `initialize()` 를 호출한 후 `onGameStart()`, `onGameEnd()` 콜백을 설정해야 합니다.

## 🚨 문제 해결

### 로그인 화면이 표시되지 않는 경우
- `gameSystem.initialize()`를 호출했는지 확인
- `gameSystem.showLoginScreen()`을 호출했는지 확인
- 컨테이너 ID가 올바른지 확인

### 점수가 저장되지 않는 경우
- 게임 이름이 올바른지 확인
- 서버가 실행 중인지 확인
- 브라우저 콘솔에서 에러 확인

### 랭킹이 표시되지 않는 경우
- API 엔드포인트가 올바른지 확인
- 네트워크 탭에서 API 응답 확인
