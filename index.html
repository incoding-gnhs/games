<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>게임 목록</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            max-width: 1200px;
            width: 100%;
            padding: 20px;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 2.5rem;
        }

        .games-grid {
            display: none;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            padding: 20px;
        }

        .game-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .game-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            border-color: #007bff;
        }

        .game-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .game-id {
            font-size: 0.9rem;
            color: #666;
            background: #f8f9fa;
            padding: 5px 10px;
            border-radius: 15px;
            display: inline-block;
        }

        .mobile-message {
            display: none;
            text-align: center;
            color: #333;
            font-size: 1.2rem;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        /* 가로 화면일 때만 게임 목록 표시 */
        @media (orientation: landscape) and (min-width: 768px) {
            .games-grid {
                display: grid;
            }
            .mobile-message {
                display: none;
            }
        }

        /* 세로 화면이거나 작은 화면일 때 메시지 표시 */
        @media (orientation: portrait), (max-width: 767px) {
            .games-grid {
                display: none;
            }
            .mobile-message {
                display: block;
            }
        }

        .loading {
            text-align: center;
            color: #666;
            font-size: 1.1rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🎮 게임 목록</h1>
        
        <div class="mobile-message">
            <h2>📱 모바일 게임</h2>
            <div id="mobileGamesGrid" class="games-grid" style="display: grid; margin-top: 20px;">
                <div class="loading">게임 목록을 불러오는 중...</div>
            </div>
        </div>

        <div class="games-grid" id="gamesGrid">
            <div class="loading">게임 목록을 불러오는 중...</div>
        </div>
    </div>

    <script>
        // 게임 파일 목록 (서버에서 동적으로 가져옴)
        let desktopGames = [];
        let mobileGames = [];

        // 서버에서 데스크탑 게임 목록 가져오기
        async function fetchDesktopGames() {
            try {
                const response = await fetch('/api/desktop-games');
                if (response.ok) {
                    desktopGames = await response.json();
                    renderGames(); // 파일 목록을 가져온 후 렌더링
                } else {
                    console.error('데스크탑 게임 목록을 가져올 수 없습니다.');
                    showError('gamesGrid', '데스크탑 게임 목록을 불러오는데 실패했습니다.');
                }
            } catch (error) {
                console.error('서버 연결 오류:', error);
                showError('gamesGrid', '서버에 연결할 수 없습니다.');
            }
        }

        // 서버에서 모바일 게임 목록 가져오기
        async function fetchMobileGames() {
            try {
                const response = await fetch('/api/mobile-games');
                if (response.ok) {
                    mobileGames = await response.json();
                    renderMobileGames(); // 파일 목록을 가져온 후 렌더링
                } else {
                    console.error('모바일 게임 목록을 가져올 수 없습니다.');
                    showError('mobileGamesGrid', '모바일 게임 목록을 불러오는데 실패했습니다.');
                }
            } catch (error) {
                console.error('서버 연결 오류:', error);
                showError('mobileGamesGrid', '서버에 연결할 수 없습니다.');
            }
        }

        // 에러 메시지 표시
        function showError(gridId, message) {
            const gamesGrid = document.getElementById(gridId);
            gamesGrid.innerHTML = `<div class="loading" style="color: #dc3545;">${message}</div>`;
        }

        // 화면 방향과 크기 확인
        function checkScreenOrientation() {
            const isLandscape = window.innerWidth > window.innerHeight;
            const isWideScreen = window.innerWidth >= 768;
            
            return isLandscape && isWideScreen;
        }

        // 게임 카드 생성 (데스크탑)
        function createGameCard(filename) {
            const gameId = filename.replace('.html', '');
            const card = document.createElement('div');
            card.className = 'game-card';
            card.onclick = () => navigateToGame(filename, 'desktop');
            
            card.innerHTML = `
                <div class="game-title">게임 ${gameId}</div>
                <div class="game-id">ID: ${gameId}</div>
            `;
            
            return card;
        }

        // 모바일 게임 카드 생성
        function createMobileGameCard(filename) {
            const gameId = filename.replace('.html', '');
            const card = document.createElement('div');
            card.className = 'game-card';
            card.onclick = () => navigateToGame(filename, 'mobile');
            
            card.innerHTML = `
                <div class="game-title">모바일 게임 ${gameId}</div>
                <div class="game-id">ID: ${gameId}</div>
            `;
            
            return card;
        }

        // 게임으로 이동
        function navigateToGame(filename, type) {
            window.location.href = `/${type}/${filename}`;
        }

        // 데스크탑 게임 목록 렌더링
        function renderGames() {
            const gamesGrid = document.getElementById('gamesGrid');
            
            if (checkScreenOrientation()) {
                if (desktopGames.length === 0) {
                    gamesGrid.innerHTML = '<div class="loading">게임 목록을 불러오는 중...</div>';
                    return;
                }
                
                gamesGrid.innerHTML = '';
                
                desktopGames.forEach(filename => {
                    const card = createGameCard(filename);
                    gamesGrid.appendChild(card);
                });
            }
        }

        // 모바일 게임 목록 렌더링
        function renderMobileGames() {
            const mobileGamesGrid = document.getElementById('mobileGamesGrid');
            
            if (mobileGames.length === 0) {
                mobileGamesGrid.innerHTML = '<div class="loading">모바일 게임이 없습니다.</div>';
                return;
            }
            
            mobileGamesGrid.innerHTML = '';
            
            mobileGames.forEach(filename => {
                const card = createMobileGameCard(filename);
                mobileGamesGrid.appendChild(card);
            });
        }

        // 초기 렌더링
        document.addEventListener('DOMContentLoaded', () => {
            fetchDesktopGames(); // 서버에서 데스크탑 게임 목록 가져오기
            fetchMobileGames(); // 서버에서 모바일 게임 목록 가져오기
        });

        // 화면 크기 변경 시 다시 확인
        window.addEventListener('resize', () => {
            renderGames();
            renderMobileGames();
        });
        window.addEventListener('orientationchange', () => {
            setTimeout(() => {
                renderGames();
                renderMobileGames();
            }, 100); // 방향 변경 후 약간의 지연
        });
    </script>
</body>
</html>
